---
title: "Wrangling data"
author: "Maggie O'Shea"
date: "4/2/2022"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(tidyverse)
hazardprops <- read.csv('/Users/maggieoshea/Desktop/2021-2022 /Duke - Fall 2021/Stats/R for Stats 710/Final Project/HazardMitigationAssistanceMitigatedProperties.csv')
```

#Note: 
I wrangled the data in two ways. First, like we talked about, I summarized amount paid over time, then looked at the amount paid for in-situ vs. ex-situ adaptation. However, all the observations before 1999 are NAs for amount paid and there are a few negative numbers (which I removed). Because of all this, I also summarized by number of properties in case we wanted to also look at that because we had data further back in time. 


#Actual Amount Paid
```{r}
#All flood properties
colnames(hazardprops)
clean_hazardprops <- hazardprops %>%
  filter(!is.na(actualAmountPaid))%>%
  filter(actualAmountPaid > 0)

floodproperties_amountpaid <- clean_hazardprops %>%
  filter(grepl('200.1|200.2|200.3|200.4|200.5|200.6|200.7|200.8|200.9|201.1|201.2|201.3|201.4|201.5|201.6|201.7|201.8|201.9|201.10|202.1|202.2|202.3|202.4|203.1|203.2|203.3|203.4|204.1|204.1|204.2|204.3|204.4|204.5|204.6|207.2', type))%>%
  group_by(programFy)%>%
  summarise(Floodproperties_amountpaid = sum(actualAmountPaid))


#Ex situ
buyoutfloodproperties_amountpaid <- clean_hazardprops %>%
  filter(grepl('200.1|200.2|200.3|200.4|200.5|200.6|200.7|200.8|200.9|201.1|201.2|201.3|201.4|201.5|201.6|201.7|201.8|201.9|201.10', type))%>%
  group_by(programFy)%>%
  summarise(Buyouts_propertiesamountpaid = sum(actualAmountPaid))

#In situ
insitufloodproperties_amountpaid <- clean_hazardprops %>%
  filter(grepl('202.1|202.2|202.3|202.4|203.1|203.2|203.3|203.4|204.1|204.1|204.2|204.3|204.4|204.5|204.6|207.2', type))%>%
  group_by(programFy)%>%
  summarise(insituproperties_amountpaid = sum(actualAmountPaid))


ggplot(floodproperties_amountpaid, aes(y= Floodproperties_amountpaid , x = programFy)) + 
  geom_line() +
  geom_smooth(method = lm, aes(y= Floodproperties_amountpaid , x = programFy), color = "coral", show.legend = FALSE)+
  labs(title = "All Flood Properties Amount Paid over Time")

ggplot(buyoutfloodproperties_amountpaid, aes(y= Buyouts_propertiesamountpaid, x = programFy)) + 
  geom_line() +
  geom_smooth(method = lm, aes(y= Buyouts_propertiesamountpaid, x = programFy), color = "coral", show.legend = FALSE)+
  labs(title = "Ex-Situ Flood Properties Amount Paid over Time")

ggplot(insitufloodproperties_amountpaid, aes(y= insituproperties_amountpaid, x = programFy)) + 
  geom_line() +
  geom_smooth(method = lm, aes(y= insituproperties_amountpaid, x = programFy), color = "coral", show.legend = FALSE)+
  labs(title = "In-Situ Flood Properties Amount Paid over Time")
```


Based on the graph and data for in-situ adaptation, 2008 looks like a bit of an outlier with a larger amount paid than the rest of the years, so I wanted to see what it looked like without 2008: 
```{r}

no2008_insitufloodproperties <- insitufloodproperties_amountpaid%>%
  filter(programFy != 2008) 

ggplot(no2008_insitufloodproperties, aes(y= insituproperties_amountpaid, x = programFy)) + 
  geom_line() +
  geom_smooth(method = lm, aes(y= insituproperties_amountpaid, x = programFy), color = "coral", show.legend = FALSE)+
  labs(title = "In-Situ Flood Properties Amount Paid over Time")

```

#Number of Properties 
```{r}
#All flood properties
floodproperties <- hazardprops %>%
  filter(grepl('200.1|200.2|200.3|200.4|200.5|200.6|200.7|200.8|200.9|201.1|201.2|201.3|201.4|201.5|201.6|201.7|201.8|201.9|201.10|202.1|202.2|202.3|202.4|203.1|203.2|203.3|203.4|204.1|204.1|204.2|204.3|204.4|204.5|204.6|207.2', type))%>%
  group_by(programFy)%>%
  summarise(Floodpropertiesperyear = sum(numberOfProperties))


#Ex situ
buyoutfloodproperties <- hazardprops %>%
  filter(grepl('200.1|200.2|200.3|200.4|200.5|200.6|200.7|200.8|200.9|201.1|201.2|201.3|201.4|201.5|201.6|201.7|201.8|201.9|201.10', type))%>%
  group_by(programFy)%>%
  summarise(Buyouts_propertiesperyear = sum(numberOfProperties))

#In situ
insitufloodproperties <- hazardprops %>%
  filter(grepl('202.1|202.2|202.3|202.4|203.1|203.2|203.3|203.4|204.1|204.1|204.2|204.3|204.4|204.5|204.6|207.2', type))%>%
  group_by(programFy)%>%
  summarise(insitupropertiesperyear = sum(numberOfProperties))


ggplot(floodproperties, aes(y= Floodpropertiesperyear, x = programFy)) + 
  geom_line() +
  geom_smooth(method = lm, aes(y= Floodpropertiesperyear, x = programFy), color = "coral", show.legend = FALSE)+
  labs(title = "All Flood Properties over Time")

ggplot(buyoutfloodproperties, aes(y= Buyouts_propertiesperyear, x = programFy)) + 
  geom_line() +
  geom_smooth(method = lm, aes(y= Buyouts_propertiesperyear, x = programFy), color = "coral", show.legend = FALSE)+
  labs(title = "Ex-Situ Flood Properties over Time")

ggplot(insitufloodproperties, aes(y= insitupropertiesperyear, x = programFy)) + 
  geom_line() +
  geom_smooth(method = lm, aes(y= insitupropertiesperyear, x = programFy), color = "coral", show.legend = FALSE)+
  labs(title = "In-Situ Flood Properties over Time")

```



